# Documentation for Code2Test

## Purpose

This Python script automates the generation of Robot Framework test suites for web applications using a multi-agent approach powered by the Google Gemini AI model. It analyzes the source code of a target web application, generates a test plan based on the Page Object Model (POM), creates the corresponding Robot Framework files (pages, keywords, tests, resources, variables), and optionally validates the generated code for correctness and adherence to POM principles.






## Prerequisites
Install:
google-generativeai Python package
Robot Framework and Selenium libraries
Selenium WebDriver (e.g., ChromeDriver)

You have a Google Gemini API key

Understanding:
Running Python scripts and using the command line
Web development basics: HTML, JS, components
Test automation, POM (Page Object Model)
Robot Framework (.robot files, keywords, resources)
Selenium locators: ID, XPath, CSS
Optional: Git and virtual environments for better workflow.

## Workflow

The script operates using a sequence of three specialized AI agents:

1.  **Agent 1: Analysis & Planning**
    *   Traverses the target application directory (`app_path`), reading the content of relevant source files while respecting ignore patterns (`IGNORE_PATTERNS`).
    *   Sends the collected source code and structure (along with optional user context) to the Gemini AI.
    *   Prompts the AI to analyze the application and generate a structured JSON plan detailing:
        *   Application summary.
        *   Recommended POM folder structure.
        *   Identified pages with elements and potential locators.
        *   Keywords to interact with pages.
        *   Test scenarios outlining steps using the defined keywords.
        *   Required resource files.
        *   Likely Robot Framework libraries needed.
        *   Basic setup notes.
    *   Parses the AI's JSON response into a Python dictionary.

2.  **Agent 2: Code Generation**
    *   Takes the JSON plan generated by Agent 1 (and optional user context).
    *   Sends this plan to the Gemini AI.
    *   Prompts the AI to generate the complete Robot Framework code (page objects, keyword files, test suites, resource files, `requirements.txt`, `README.md`) strictly following the provided plan and POM structure.
    *   Parses the AI's response, extracting the content for each generated file based on `--- File: path/to/file ---` delimiters.

3.  **Agent 3: Validation & Enhancement (Optional)**
    *   Takes the JSON plan (Agent 1) and the generated files (Agent 2) (along with optional user context).
    *   Sends this information to a potentially more capable Gemini AI model.
    *   Prompts the AI to act as a Robot Framework POM expert, rigorously validating the generated code against the plan and best practices. Checks include:
        *   Correct POM structure separation (locators in pages, actions in keywords, calls in tests).
        *   Correct file organization and relative imports.
        *   Presence of all required elements and keywords.
        *   Absence of hardcoded locators in keywords.
        *   Correct Robot Framework syntax and library usage.
        *   Completeness of test steps, setup/teardown.
    *   Instructs the AI to fix any identified issues and provide the complete, corrected set of files, along with a JSON validation report.
    *   Parses the AI's response to extract the validation report and the potentially corrected file contents. This step can be skipped using the `--skip-validation` flag.

4.  **File Storage**
    *   Takes the final set of files (either directly from Agent 2 or after correction by Agent 3).
    *   Writes these files to the specified output directory (`--output`), creating necessary subdirectories based on the POM structure defined in the plan.
    *   Can optionally clear the output directory before writing using `--clear-output`.


## Usage

Run the script from your terminal:

```bash
python code2test.py <app_path> [options]
```

**Arguments:**

*   `app_path` (Required): Path to the root directory of the web application you want to analyze.
*   `-c`, `--context` (Optional): A string containing extra context, instructions, or overrides to provide to all AI agents. This can help guide the generation process (e.g., "Focus on login and checkout flows", "Use CSS selectors primarily").
*   `-o`, `--output` (Optional): The directory where the generated Robot Framework files will be saved. Defaults to `robot_tests`.
*   `--clear-output` (Optional Flag): If set, the script will delete the output directory if it exists before writing the new files. Use with caution!
*   `--api-key` (Optional): Your Google Gemini API key. If not provided, the script will look for the `GEMINI_API_KEY` environment variable.
*   `--skip-validation` (Optional Flag): If set, the script will skip Agent 3 (Validation) and directly save the files generated by Agent 2.
*   `--save-intermediate` (Optional Flag): If set, saves intermediate files for debugging:
    *   `intermediate_plan.json`: The JSON plan from Agent 1.
    *   `intermediate_generation/`: A directory containing the raw files generated by Agent 2.
    *   `validation_report.json`: The JSON validation report from Agent 3 (if validation is not skipped).
    *   `validation_prompt.txt`: The exact prompt sent to Agent 3.

**Example:**

```bash
# Analyze the app in './sample-app-web', save tests to 'my_saucedemo_tests', 
# provide context, and clear the output dir first
export GEMINI_API_KEY="YOUR_API_KEY_HERE" # Or use --api-key
python code2test.py ./sample-app-web -o my_saucedemo_tests --clear-output 
-c "The application is SauceDemo. Prioritize tests for standard_user login 
and purchasing a single item."
```

## Setup

1.  **Python:** Ensure you have Python 3 installed.
2.  **Dependencies:** Install the required Python library:
    ```bash
    pip install google-generativeai
    ```
    The script will generate a `requirements.txt` file for the Robot Framework project itself, which will likely include:
    ```
    robotframework
    robotframework-seleniumlibrary
    # Potentially other libraries identified by Agent 1
    ```
    You will need to install these separately to run the generated tests:
    ```bash
    pip install -r <output_directory>/requirements.txt
    ```
3.  **Gemini API Key:** Obtain an API key from Google AI Studio ([https://aistudio.google.com/](https://aistudio.google.com/)). Provide it to the script either via:
    *   The `--api-key` command-line argument.
    *   Setting the `GEMINI_API_KEY` environment variable.
4.  **WebDriver:** To run the generated Selenium-based Robot tests, you will need the appropriate WebDriver (e.g., ChromeDriver, GeckoDriver) installed and accessible in your system's PATH.

## Input Application Structure

The script works best with standard web application structures (e.g., React, Vue, Angular, traditional MVC). It reads source files like `.js`, `.jsx`, `.ts`, `.tsx`, `.html`, `.py`, `.java`, etc., to understand the application's components, pages, and potential user interactions.

## Output Structure

The script generates a Robot Framework project typically structured like this (based on the plan from Agent 1):

```
<output_directory>/
├── pages/
│   ├── LoginPage.robot
│   └── InventoryPage.robot
│   └── ... (other page objects)
├── keywords/
│   ├── LoginKeywords.robot
│   └── InventoryKeywords.robot
│   └── ... (other keyword files)
├── tests/
│   ├── LoginTests.robot
│   └── InventoryTests.robot
│   └── ... (other test suites)
├── resources/
│   └── CommonResources.robot
│   └── BrowserSetup.robot
│   └── ... (other resource files)
├── variables/
│   └── GlobalVariables.robot
│   └── ... (other variable files)
├── README.md         (Generated explanation)
└── requirements.txt  (Generated Python dependencies for the tests)
```

## Ignoring Files/Directories

The script uses a predefined list `IGNORE_PATTERNS` (lines 13-55 in `code2test.py`) to avoid analyzing irrelevant files or directories (like `node_modules`, `.git`, build outputs, the script itself, log files, etc.). It also automatically ignores the specified `--output` directory to prevent analyzing previously generated tests. The `should_ignore` function uses `fnmatch` for pattern matching against both file/directory base names and individual path components.